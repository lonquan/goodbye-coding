# Coding 到 GitHub 代码仓库迁移工具

## 功能概述
创建一个基于 Symfony Console 和 Symfony Process 的命令行工具，用于将 Coding 平台上的代码仓库批量迁移到 GitHub 平台。

## 用户故事

### 作为开发者
- 我希望能够通过命令行工具将 Coding 上的所有代码仓库迁移到 GitHub
- 我希望能够自定义 GitHub 组织名称（默认为 ant-cool）
- 我希望能够自定义迁移后的仓库命名格式（默认为 {Coding 项目名称}-{Coding 仓库名称}）
- 我希望能够看到详细的仓库列表，包括项目名称、仓库名称、描述、大小等信息
- 我希望能够交互式地选择要迁移的仓库，默认全选，支持反选排除
- 我希望能够预览迁移计划，包括源仓库和目标仓库的对应关系
- 我希望能够看到迁移进度和状态反馈
- 我希望能够处理迁移过程中的错误和重试机制
- 我希望能够强制覆盖已存在的 GitHub 仓库

### 作为管理员
- 我希望能够配置 Coding 和 GitHub 的认证信息
- 我希望能够选择性地迁移特定项目或仓库
- 我希望能够预览迁移计划而不实际执行
- 我希望能够生成迁移报告

## 功能需求

### 核心功能
1. **认证管理**
   - 支持 Coding API Token 配置
   - 支持 GitHub Personal Access Token 配置
   - 安全的凭据存储和验证

2. **仓库发现**
   - 获取 Coding 用户/组织下的所有项目
   - 获取每个项目下的所有代码仓库
   - 支持分页和过滤

3. **仓库迁移**
   - 克隆 Coding 仓库到本地临时目录
   - 在 GitHub 上创建对应的仓库
   - 推送代码到 GitHub 仓库
   - 清理本地临时文件

4. **命名规则**
   - 支持自定义仓库命名格式
   - 默认格式：{Coding 项目名称}-{Coding 仓库名称}
   - 支持特殊字符处理和长度限制

5. **进度跟踪**
   - 实时显示迁移进度
   - 详细的日志记录
   - 错误处理和重试机制

6. **交互式界面**
   - 显示详细的仓库列表（项目名、仓库名、描述、大小、最后更新时间）
   - 支持全选/反选操作
   - 支持单个仓库的选择/取消选择
   - 预览迁移计划（源仓库 → 目标仓库映射）
   - 确认后开始执行迁移

### 高级功能
1. **批量操作**
   - 支持批量迁移多个项目
   - 支持并行迁移（可配置并发数）
   - 支持断点续传

2. **配置管理**
   - 配置文件支持（YAML/JSON）
   - 环境变量支持
   - 命令行参数覆盖

3. **报告生成**
   - 迁移成功/失败统计
   - 详细的迁移日志
   - 可导出的报告文件

## 非功能需求

### 性能要求
- 单个仓库迁移时间 < 2 分钟（取决于仓库大小）
- 支持并发迁移，默认并发数 3
- 内存使用 < 512MB

### 可靠性要求
- 网络错误自动重试（最多 3 次）
- 支持断点续传
- 完整的错误日志记录

### 安全性要求
- 敏感信息（API Token）加密存储
- 不在日志中记录敏感信息
- 支持 HTTPS 传输

### 可用性要求
- 命令行界面友好
- 详细的帮助文档
- 清晰的错误提示

## 技术约束

### 必需技术栈
- PHP 8.4+
- Symfony Console 7.x
- Symfony Process 7.x
- Composer 2.x

### 外部依赖
- Coding API
- GitHub API
- Git 命令行工具

### 平台支持
- Linux/macOS/Windows
- 需要 Git 环境
- 需要网络访问

## 成功标准

### 功能标准
- [ ] 能够成功迁移 Coding 仓库到 GitHub
- [ ] 支持自定义组织名称和命名格式
- [ ] 提供完整的进度反馈和错误处理
- [ ] 支持批量操作和配置管理

### 质量标准
- [ ] 代码覆盖率 > 90%
- [ ] 通过 PHPStan Level 8 静态分析
- [ ] 遵循 PSR-12 代码规范
- [ ] 完整的单元测试和集成测试

### 文档标准
- [ ] 完整的 README 文档
- [ ] API 文档（PHPDoc）
- [ ] 使用示例和最佳实践
- [ ] 故障排除指南

## 验收标准

### 基本迁移
1. 配置 Coding 和 GitHub 认证信息
2. 执行迁移命令，成功迁移至少 1 个仓库
3. 验证 GitHub 上仓库创建成功且代码完整
4. 验证仓库命名符合指定格式

### 批量迁移
1. 配置批量迁移参数
2. 执行批量迁移，成功迁移多个仓库
3. 验证所有仓库都正确迁移
4. 生成迁移报告

### 错误处理
1. 模拟网络错误，验证重试机制
2. 模拟认证错误，验证错误提示
3. 模拟权限错误，验证错误处理

## 技术架构

### 核心组件
- **Command**: Symfony Console 命令
- **Service**: 业务逻辑服务
- **Repository**: 数据访问层
- **Client**: API 客户端
- **Config**: 配置管理

### 数据流
1. 读取配置 → 验证认证
2. 获取 Coding 项目列表 → 获取仓库列表
3. 克隆仓库 → 创建 GitHub 仓库 → 推送代码
4. 记录日志 → 生成报告

## 风险与限制

### 技术风险
- API 限制和频率限制
- 网络不稳定导致迁移失败
- 大仓库迁移时间过长

### 业务风险
- 敏感代码泄露
- 仓库权限配置错误
- 命名冲突

### 缓解措施
- 实现重试机制和错误恢复
- 添加权限验证和确认步骤
- 支持预览模式和回滚功能
